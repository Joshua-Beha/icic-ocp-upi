###############################################################################
# Â© Copyright IBM Corporation 2021
# Contributed by the Ansible Content for IBM Z Team
#
# Changelog
#  All notable changes to this sample will be documented in this playbook
#
# 2021-04-30
#  - Released initial version
###############################################################################

###############################################################################
# Requirements:
#     - IBM z/OS core collection 1.3.0 or later
###############################################################################

- hosts: zos_host
  collections:
    - ibm.ibm_zos_core
  gather_facts: no
  environment: "{{ environment_vars }}"

  roles:
    - role: issue_racf_cmd
      system_name: 'EC01129A'
      task_description: 'Create new certs and connect to keyring'
      command:
          - RACDCERT GENCERT CERTAUTH KEYUSAGE(CERTSIGN) SUBJECTSDN(CN('TEST CA') +
          - OU('ANSIBLE CORE') C('US')) WITHLABEL('TEST CA CERT')
          - RACDCERT ID({{ansible_user}}) CONNECT(CERTAUTH LABEL('TEST CA CERT') +
          - RING(WEBSSL))
          - RACDCERT GENCERT ID({{ansible_user}}) SUBJECTSDN(CN('www.TEST.com') +
          - OU('ANSIBLE CORE') C('US')) WITHLABEL('WEB SERVER CERT')  +
          - SIGNWITH(CERTAUTH LABEL('TEST CA CERT')) +
          - NOTAFTER(DATE(2021-05-28))
          - RACDCERT ID({{ansible_user}}) CONNECT(LABEL('WEB SERVER CERT') +
          - RING(WEBSSL) DEFAULT)
          - RACDCERT LISTRING(WEBSSL)
          - RACDCERT LISTCHAIN (LABEL('WEB SERVER CERT')) ID({{ansible_user}})


